<div class="admin-dashboard">
  <header class="dashboard-header">
    <h1>Admin Dashboard</h1>
    <button class="logout-btn" (click)="logout()">Logout</button>
  </header>

  <div class="tabs">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'ngos'"
      (click)="switchTab('ngos')">
      NGOs ({{ ngos.length }})
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'donors'"
      (click)="switchTab('donors')">
      Donors ({{ donors.length }})
    </button>
  </div>

  <div class="filters">
    <input 
      type="text" 
      placeholder="Search..." 
      [(ngModel)]="searchTerm"
      (keyup.enter)="onSearch()" />
    <select [(ngModel)]="filterBlocked" (change)="onSearch()">
      <option value="">All</option>
      <option value="true">Blocked</option>
      <option value="false">Active</option>
    </select>
    <button (click)="onSearch()">Search</button>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <div *ngIf="isLoading" class="loading">Loading...</div>

  <!-- NGOs Tab -->
  <div *ngIf="activeTab === 'ngos' && !isLoading" class="table-container">
    <table>
      <thead>
        <tr>
          <th>NGO ID</th>
          <th>NGO Name</th>
          <th>Registration Number</th>
          <th>Email</th>
          <th>Contact Person</th>
          <th>Verification Status</th>
          <th>Created Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let ngo of ngos">
          <td><strong>{{ ngo.ngo_id || 'N/A' }}</strong></td>
          <td>{{ ngo.name }}</td>
          <td>{{ ngo.registrationNumber || 'N/A' }}</td>
          <td>{{ ngo.email }}</td>
          <td>{{ ngo.contactPersonName || ngo.contactInfo || 'N/A' }}</td>
          <td>
            <span [class]="getVerificationStatusClass(ngo.verificationStatus)">
              {{ getVerificationStatusText(ngo.verificationStatus) }}
            </span>
            <div *ngIf="ngo.verificationStatus === 'REJECTED' && ngo.rejectionReason" 
                 class="rejection-reason" 
                 [title]="ngo.rejectionReason">
              Reason: {{ ngo.rejectionReason }}
            </div>
          </td>
          <td>{{ ngo.createdAt | date:'short' }}</td>
          <td class="action-buttons">
            <div class="verification-actions" *ngIf="ngo.verificationStatus === 'PENDING'">
              <button class="approve-btn" (click)="approveNgo(ngo)" title="Approve NGO">
                ✅ Approve
              </button>
              <button class="reject-btn" (click)="rejectNgo(ngo)" title="Reject NGO">
                ❌ Reject
              </button>
            </div>
            <div class="block-actions">
              <button 
                [class.block-btn]="!ngo.isBlocked"
                [class.unblock-btn]="ngo.isBlocked"
                (click)="toggleBlockNgo(ngo)">
                {{ ngo.isBlocked ? 'Unblock' : 'Block' }}
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="ngos.length === 0">
          <td colspan="8" class="no-data">No NGOs found</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Donors Tab -->
  <div *ngIf="activeTab === 'donors' && !isLoading" class="table-container">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Contact</th>
          <th>Total Contributions</th>
          <th>Approved</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let donor of donors">
          <td>{{ donor.id }}</td>
          <td>{{ donor.name }}</td>
          <td>{{ donor.email }}</td>
          <td>{{ donor.contactInfo }}</td>
          <td>{{ donor.statistics?.totalContributions || 0 }}</td>
          <td>{{ donor.statistics?.approvedContributions || 0 }}</td>
          <td>
            <span [class.blocked]="donor.isBlocked">
              {{ donor.isBlocked ? 'Blocked' : 'Active' }}
            </span>
          </td>
          <td>
            <button 
              [class.block-btn]="!donor.isBlocked"
              [class.unblock-btn]="donor.isBlocked"
              (click)="toggleBlockDonor(donor)">
              {{ donor.isBlocked ? 'Unblock' : 'Block' }}
            </button>
          </td>
        </tr>
        <tr *ngIf="donors.length === 0">
          <td colspan="8" class="no-data">No Donors found</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>


<div class="complete-profile-container">
  <!-- Header -->
  <header class="profile-header">
    <button mat-icon-button class="back-button" (click)="cancel()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <div class="header-content">
      <h1 class="page-title">
        <mat-icon>person</mat-icon>
        Complete Your Profile
      </h1>
      <p class="page-subtitle">Fill in your NGO details to get started</p>
    </div>
  </header>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading profile...</p>
  </div>

  <!-- Profile Content -->
  <div *ngIf="!isLoading" class="profile-content">
    <!-- Profile Completion Progress -->
    <mat-card class="progress-card">
      <mat-card-content>
        <div class="progress-header">
          <div class="progress-info">
            <h3>Profile Completion</h3>
            <span class="completion-percentage">{{ calculateProfileCompletion() }}%</span>
          </div>
        </div>
        <mat-progress-bar 
          mode="determinate" 
          [value]="calculateProfileCompletion()"
          [color]="calculateProfileCompletion() === 100 ? 'primary' : 'accent'">
        </mat-progress-bar>
        <p class="progress-hint">Complete all fields to finish your profile setup</p>
      </mat-card-content>
    </mat-card>

    <!-- Two Column Layout -->
    <div class="profile-layout">
      <!-- LEFT SIDE: Read-only Information -->
      <mat-card class="info-card left-panel">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>info</mat-icon>
            Organization Information
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="info-section">
            <!-- NGO ID -->
            <div class="info-item">
              <div class="info-label">
                <mat-icon>badge</mat-icon>
                <span>NGO ID</span>
              </div>
              <div class="info-value readonly">
                {{ ngoId || 'N/A' }}
                <mat-icon class="lock-icon" matTooltip="Auto-generated, cannot be changed">lock</mat-icon>
              </div>
            </div>

            <mat-divider></mat-divider>

            <!-- NGO Name -->
            <div class="info-item">
              <div class="info-label">
                <mat-icon>business</mat-icon>
                <span>NGO Name</span>
              </div>
              <div class="info-value readonly">
                {{ ngoName }}
                <mat-icon class="lock-icon" matTooltip="Read-only after verification">lock</mat-icon>
              </div>
            </div>

            <mat-divider></mat-divider>

            <!-- Registration Number -->
            <div class="info-item">
              <div class="info-label">
                <mat-icon>description</mat-icon>
                <span>Registration Number</span>
              </div>
              <div class="info-value readonly">
                {{ registrationNumber }}
                <mat-icon class="lock-icon" matTooltip="Read-only, requires admin approval to change">lock</mat-icon>
              </div>
            </div>

            <mat-divider></mat-divider>

            <!-- Verification Status -->
            <div class="info-item">
              <div class="info-label">
                <mat-icon>verified</mat-icon>
                <span>Verification Status</span>
              </div>
              <div class="info-value">
                <mat-chip [class.verified-chip]="isVerified" [class.pending-chip]="!isVerified">
                  {{ isVerified ? 'Verified' : 'Pending Verification' }}
                </mat-chip>
              </div>
            </div>

            <mat-divider></mat-divider>

            <!-- Email -->
            <div class="info-item">
              <div class="info-label">
                <mat-icon>email</mat-icon>
                <span>Email</span>
              </div>
              <div class="info-value readonly">
                {{ email || 'Not provided' }}
              </div>
            </div>

            <mat-divider></mat-divider>

            <!-- Address (Read-only) -->
            <div class="info-item">
              <div class="info-label">
                <mat-icon>location_on</mat-icon>
                <span>Address</span>
              </div>
              <div class="info-value readonly">
                {{ address || 'Not provided' }}
                <span class="admin-note" *ngIf="!adminApprovalForEdit">
                  <mat-icon>info</mat-icon>
                  Requires admin approval
                </span>
              </div>
            </div>

            <mat-divider *ngIf="city || state || pincode"></mat-divider>

            <!-- City, State, Pincode -->
            <div class="info-item" *ngIf="city || state || pincode">
              <div class="info-label">
                <mat-icon>place</mat-icon>
                <span>Location</span>
              </div>
              <div class="info-value readonly">
                <span *ngIf="city">{{ city }}</span>
                <span *ngIf="city && state">, </span>
                <span *ngIf="state">{{ state }}</span>
                <span *ngIf="pincode"> - {{ pincode }}</span>
                <span *ngIf="!city && !state && !pincode">Not provided</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- RIGHT SIDE: Editable Form -->
      <mat-card class="form-card right-panel">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>edit</mat-icon>
            Profile Details
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <form class="profile-form" (ngSubmit)="saveProfile()">
            <!-- Contact Person Name -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Contact Person Name *</mat-label>
              <input matInput 
                     [(ngModel)]="profileForm.contactPersonName" 
                     name="contactPersonName"
                     placeholder="Enter contact person's full name"
                     required>
              <mat-icon matPrefix>person</mat-icon>
              <mat-hint>Name of the primary contact person</mat-hint>
            </mat-form-field>

            <!-- Phone Number -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Phone Number *</mat-label>
              <input matInput 
                     type="tel"
                     [(ngModel)]="profileForm.phoneNumber" 
                     name="phoneNumber"
                     placeholder="Enter phone number"
                     required>
              <mat-icon matPrefix>phone</mat-icon>
              <mat-hint>Include country code if applicable</mat-hint>
            </mat-form-field>

            <!-- About NGO / Description -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>About NGO / Description</mat-label>
              <textarea matInput 
                        [(ngModel)]="profileForm.aboutNgo" 
                        name="aboutNgo"
                        placeholder="Tell us about your NGO, its mission, and activities"
                        rows="5"></textarea>
              <mat-icon matPrefix>description</mat-icon>
              <mat-hint>Describe your NGO's purpose and activities</mat-hint>
            </mat-form-field>

            <!-- Website URL -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Website URL (Optional)</mat-label>
              <input matInput 
                     type="url"
                     [(ngModel)]="profileForm.websiteUrl" 
                     name="websiteUrl"
                     placeholder="https://www.example.com">
              <mat-icon matPrefix>language</mat-icon>
              <mat-hint>Your NGO's website URL</mat-hint>
            </mat-form-field>

            <!-- NGO Logo Upload -->
            <div class="logo-upload-section">
              <label class="logo-label">
                <mat-icon>image</mat-icon>
                <span>NGO Logo (Optional)</span>
              </label>
              <div class="logo-preview-container">
                <div *ngIf="logoPreview" class="logo-preview">
                  <img [src]="logoPreview" alt="NGO Logo">
                  <button mat-icon-button 
                          type="button"
                          class="remove-logo-btn" 
                          (click)="removeLogo()"
                          matTooltip="Remove logo">
                    <mat-icon>close</mat-icon>
                  </button>
                </div>
                <div *ngIf="!logoPreview" class="logo-placeholder">
                  <mat-icon>image</mat-icon>
                  <p>No logo uploaded</p>
                </div>
              </div>
              <input type="file" 
                     accept="image/*" 
                     (change)="onLogoSelected($event)"
                     id="logo-upload"
                     style="display: none;">
              <button mat-stroked-button 
                      type="button"
                      (click)="triggerLogoUpload()"
                      class="upload-btn">
                <mat-icon>upload</mat-icon>
                {{ logoPreview ? 'Change Logo' : 'Upload Logo' }}
              </button>
              <p class="upload-hint">Recommended: Square image, max 5MB (PNG, JPG)</p>
            </div>

            <!-- Admin Approval Message -->
            <div class="admin-message" *ngIf="!adminApprovalForEdit">
              <mat-icon>info</mat-icon>
              <div>
                <strong>Address and registration details</strong> can be changed only after admin approval.
                Contact support if you need to update these fields.
              </div>
            </div>

            <!-- Error Message -->
            <div *ngIf="formError" class="error-message">
              <mat-icon>error</mat-icon>
              <span>{{ formError }}</span>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
              <button mat-raised-button 
                      color="primary" 
                      type="submit"
                      [disabled]="isSaving">
                <mat-icon *ngIf="!isSaving">save</mat-icon>
                <mat-spinner *ngIf="isSaving" diameter="20" class="button-spinner"></mat-spinner>
                {{ isSaving ? 'Saving...' : 'Save Profile' }}
              </button>
              <button mat-stroked-button 
                      type="button"
                      (click)="cancel()"
                      [disabled]="isSaving">
                <mat-icon>cancel</mat-icon>
                Cancel
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>

